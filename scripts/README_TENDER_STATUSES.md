# –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫—É–ø–æ–∫

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∑–∞–∫—É–ø–æ–∫, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –ò—Å–∫–ª—é—á–∞—Ç—å "–ø–ª–æ—Ö–∏–µ" –∑–∞–ø–∏—Å–∏ –∏–∑ –ø–æ–∏—Å–∫–∞
- ‚úÖ –£—Å–∫–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–Ω–¥–µ–∫—Å–∞–º –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –î–∞–Ω–Ω—ã–µ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è!

–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ **–ù–ï —É–¥–∞–ª—è–µ—Ç** –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î. –û–Ω —Ç–æ–ª—å–∫–æ:
- –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `tender_statuses`
- –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `status_id` –≤ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫—É–ø–æ–∫
- **–û–±–Ω–æ–≤–ª—è–µ—Ç** (UPDATE) –∑–Ω–∞—á–µ–Ω–∏—è `status_id` –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
python scripts/apply_tender_statuses_migration.py
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ psql:

```bash
psql -h localhost -U postgres -d tender_monitor -f scripts/add_tender_statuses_migration.sql
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

```bash
psql -h localhost -U postgres -d tender_monitor -f scripts/update_tender_statuses_function.sql
```

–ò–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìä –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫—É–ø–æ–∫

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –£—Å–ª–æ–≤–∏–µ –¥–ª—è 44–§–ó | –£—Å–ª–æ–≤–∏–µ –¥–ª—è 223–§–ó |
|----|----------|-------------------|-------------------|
| 1 | –ù–æ–≤–∞—è | `end_date <= CURRENT_DATE` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| 2 | –†–∞–±–æ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ | `end_date > CURRENT_DATE AND end_date <= CURRENT_DATE + 90 –¥–Ω–µ–π` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| 3 | –†–∞–∑—ã–≥—Ä–∞–Ω–∞ | `delivery_end_date >= CURRENT_DATE + 90 –¥–Ω–µ–π` | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| 4 | –ü–ª–æ—Ö–∏–µ | `delivery_end_date IS NULL` | `end_date > CURRENT_DATE + 180 –¥–Ω–µ–π` |

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:

1. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏** –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞ (status_id IS NULL)
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏** —Å —Ö–æ—Ä–æ—à–∏–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ (1, 2, 3)
3. **–ò—Å–∫–ª—é—á–∞–µ—Ç "–ü–ª–æ—Ö–∏–µ"** (status_id = 4) –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–∏ –≤ –ë–î

- `update_tender_statuses_44fz()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è 44–§–ó
- `update_tender_statuses_223fz()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è 223–§–ó
- `update_all_tender_statuses()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã (44–§–ó + 223–§–ó)

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã
SELECT * FROM update_all_tender_statuses();

-- –ò–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è 44–§–ó
SELECT * FROM update_tender_statuses_44fz();

-- –ò–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è 223–§–ó
SELECT * FROM update_tender_statuses_223fz();
```

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

### –î–ª—è 44–§–ó: –ò—Å–∫–ª—é—á–∞–µ–º "–ü–ª–æ—Ö–∏–µ" –∏–∑ –ø–æ–∏—Å–∫–∞

```sql
-- –ù–æ–≤—ã–µ –∑–∞–∫—É–ø–∫–∏
SELECT * FROM reestr_contract_44_fz
WHERE status_id = 1;

-- –†–∞–±–æ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏
SELECT * FROM reestr_contract_44_fz
WHERE status_id = 2;

-- –†–∞–∑—ã–≥—Ä–∞–Ω–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏
SELECT * FROM reestr_contract_44_fz
WHERE status_id = 3;

-- –í—Å–µ —Ö–æ—Ä–æ—à–∏–µ –∑–∞–∫—É–ø–∫–∏ (–∏—Å–∫–ª—é—á–∞—è "–ü–ª–æ—Ö–∏–µ")
SELECT * FROM reestr_contract_44_fz
WHERE status_id IN (1, 2, 3);
```

### –î–ª—è 223–§–ó: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞

```sql
-- –í—Å–µ –∑–∞–∫—É–ø–∫–∏ 223–§–ó (–∏—Å–∫–ª—é—á–∞—è "–ü–ª–æ—Ö–∏–µ")
SELECT * FROM reestr_contract_223_fz
WHERE status_id IS NULL OR status_id != 4;
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î (–Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è)
- ‚úÖ –ó–∞–ø–∏—Å–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è —Å—Ç–∞—Ç—É—Å–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ "–ü–ª–æ—Ö–∏–µ" –∑–∞–ø–∏—Å–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –ø–æ–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–Ω–¥–µ–∫—Å–∞–º –ø–æ status_id
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∑–∞–∫—É–ø–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìù –ü—Ä–∏–º–µ—Ä—ã

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–º. –≤ —Ñ–∞–π–ª–µ `scripts/tender_statuses_examples.md`

