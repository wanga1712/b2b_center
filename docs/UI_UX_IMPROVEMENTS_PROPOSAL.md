# 📊 Предложения по улучшению UI/UX приложения B2B AutoDesk

## 🎯 Цель документа

Комплексный анализ текущего интерфейса и предложения по улучшению UX/UI с ориентацией на лучшие практики Salesforce, Битрикс24 и Trello.

---

## 📝 Текущее состояние

### Сильные стороны
✅ Модульная архитектура (хорошо для расширения)  
✅ Единая система стилей (general_styles.py)  
✅ Централизованная конфигурация UI (ui_config.py)  
✅ Канбан-доски для воронок продаж  
✅ Drag-and-drop для перемещения карточек  
✅ Детальные карточки сделок с вкладками  

### Слабые стороны
❌ Карточки сделок слишком минималистичные (мало визуальной информации)  
❌ Отсутствует дашборд с аналитикой и метриками  
❌ Нет глобального поиска по всем сущностям  
❌ Отсутствует центр уведомлений и активности  
❌ Нет быстрых действий на карточках (контекстное меню)  
❌ Отсутствуют фильтры и группировка в канбане  
❌ Детальная карточка не показывает историю изменений  
❌ Нет прикрепления файлов к сделкам  
❌ Отсутствуют комментарии и обсуждения  
❌ Нет тегов/меток для категоризации  
❌ Отсутствует календарь событий и дедлайнов  

---

## 🎨 РАЗДЕЛ 1: Улучшения визуального дизайна

### 1.1. Карточки сделок в канбане (DealCard)

#### Текущее состояние
```
┌─────────────────────────┐
│ Закупка (№518801)      │
│ 📋 Закупка №518801     │
│ 💰 100 000 ₽          │
│ 📊 Маржа: 10.0%       │
└─────────────────────────┘
```

#### Предложение: Расширенная карточка (стиль Trello + Битрикс24)
```
┌─────────────────────────────────────────┐
│ 🔴 Закупка (№518801)                    │ ← Цветовой индикатор приоритета
│ ────────────────────────────────────────│
│ 👤 Иванов И.И.          📅 До 20.12.24 │ ← Ответственный и дедлайн
│ 💰 100 000 ₽           📊 Маржа: 10%  │
│ ────────────────────────────────────────│
│ 🏷️ Гидроизоляция  🏷️ Мост             │ ← Теги
│ 📎 3 файла  💬 5 комментариев          │ ← Счетчики
│ ────────────────────────────────────────│
│ ⚡ [⋮] [✏️] [📋] [🗑️]                  │ ← Быстрые действия
└─────────────────────────────────────────┘
```

**Компоненты для добавления:**
- **Цветовая полоса слева** (приоритет: 🔴 Высокий, 🟡 Средний, 🟢 Низкий)
- **Аватар ответственного** с tooltip
- **Индикатор дедлайна** с подсветкой (красный - просрочен, желтый - скоро)
- **Прогресс-бар выполнения** (если есть чеклисты/подзадачи)
- **Теги/метки** (цветные чипсы)
- **Счетчики**: файлы, комментарии, подзадачи
- **Быстрые действия** (при hover): редактировать, копировать, удалить, просмотреть
- **Drag-handle** (⋮⋮) для явного указания возможности перетаскивания

### 1.2. Верхняя панель (TopBar)

#### Текущее состояние
```
🚀 B2B AutoDesk — автоматизация бизнес-процессов    [➕ Создать] [📄 Экспорт] [✉️ Email]
```

#### Предложение: Расширенный TopBar (стиль Salesforce)
```
┌────────────────────────────────────────────────────────────────────────────┐
│ 🚀 B2B AutoDesk  │  🔍 Глобальный поиск...  │  🔔(3)  👤  ⚙️  ❓       │
└────────────────────────────────────────────────────────────────────────────┘
```

**Компоненты для добавления:**
- **Глобальный поиск** (Ctrl+K / Cmd+K) - поиск по всем сущностям
- **Центр уведомлений** 🔔 с бейджем непрочитанных
- **Профиль пользователя** 👤 с выпадающим меню
- **Настройки** ⚙️ (быстрый доступ)
- **Помощь** ❓ (документация, горячие клавиши)
- **Быстрое создание** ➕ (универсальная кнопка с выбором типа сущности)

### 1.3. Боковая панель (Sidebar)

#### Предложение: Улучшенная навигация
```
┌──────────────────────┐
│ 🏠 Главная          │
│ 📊 Дашборд          │ ← Новый раздел!
│ ═══════════════════ │
│ 💼 Сделки           │
│ 📋 Закупки          │
│ 📄 КП               │
│ 👥 Клиенты          │
│ 📅 Календарь        │ ← Новый раздел!
│ 📈 Отчеты           │ ← Новый раздел!
│ ═══════════════════ │
│ ✅ Задачи           │
│ 🚚 Отгрузка         │
│ 🤖 AI Ассистент     │
│ ═══════════════════ │
│ ⚙️ Настройки        │
└──────────────────────┘
```

---

## 🚀 РАЗДЕЛ 2: Новые функциональные компоненты

### 2.1. Дашборд (Dashboard) - КРИТИЧНО ВАЖНО

**Местоположение**: Новый раздел "Дашборд" в главном меню  
**Референс**: Salesforce Lightning, Битрикс24 CRM

#### Структура дашборда

```
┌────────────────────────────────────────────────────────────────┐
│  📊 Дашборд CRM                                    [⚙️ Настроить] │
└────────────────────────────────────────────────────────────────┘

┌──────────────┬──────────────┬──────────────┬──────────────┐
│ Всего сделок │ Сумма сделок │ Конверсия    │ Ср. маржа    │
│   128        │ 12.5 млн ₽   │    24.5%     │    15.2%     │
│ +12% ↗       │ +8% ↗        │ -2% ↘        │ +3% ↗        │
└──────────────┴──────────────┴──────────────┴──────────────┘

┌──────────────────────────────┬──────────────────────────────┐
│  📈 Воронка продаж           │  📅 Активность               │
│                              │                              │
│  [График воронки]            │  [График активности]         │
│                              │                              │
└──────────────────────────────┴──────────────────────────────┘

┌──────────────────────────────┬──────────────────────────────┐
│  🎯 Топ сделки               │  ⚡ Требуют внимания          │
│                              │                              │
│  1. Закупка №518801          │  🔴 Закупка №502187          │
│     100 000 ₽                │     Просрочен дедлайн!       │
│  2. Закупка №518802          │  🟡 Закупка №518795          │
│     85 000 ₽                 │     Завтра истекает срок     │
│                              │                              │
└──────────────────────────────┴──────────────────────────────┘
```

**Виджеты дашборда:**
1. **KPI карточки** (метрики с трендами)
   - Всего сделок (с динамикой)
   - Сумма сделок
   - Конверсия воронки
   - Средняя маржа
   - Количество закупок
   - Win rate (процент выигранных)

2. **График воронки продаж** (визуализация этапов)
   - Количество сделок на каждом этапе
   - Конверсия между этапами
   - Средний цикл сделки

3. **График активности** (временная шкала)
   - Созданные сделки
   - Перемещения по этапам
   - Выигранные/проигранные

4. **Топ сделки** (по сумме)
   - Название
   - Сумма
   - Ответственный
   - Статус

5. **Требуют внимания** (приоритеты)
   - Просроченные дедлайны
   - Застрявшие на этапе
   - Без активности N дней

6. **Календарь событий** (компактный вид)
   - Дедлайны
   - Встречи
   - Звонки

### 2.2. Глобальный поиск (Command Palette)

**Горячая клавиша**: `Ctrl+K` / `Cmd+K`  
**Референс**: Spotlight (macOS), GitHub Command Palette

#### Функциональность
```
┌──────────────────────────────────────────────────┐
│  🔍 Поиск по всему...                           │
│  ─────────────────────────────────────────────── │
│  📋 Закупка №518801 - Поставка материалов       │
│  💼 Сделка "Мост через реку" - 100 000 ₽       │
│  👤 ООО "Строймастер" - Заказчик                │
│  📄 КП-2024-001 - 85 000 ₽                      │
│  ⚡ Команды:                                      │
│     ➕ Создать сделку                            │
│     📊 Открыть дашборд                           │
│     ⚙️ Настройки                                 │
└──────────────────────────────────────────────────┘
```

**Возможности:**
- Поиск по сделкам
- Поиск по закупкам
- Поиск по клиентам
- Поиск по КП
- Поиск по контактам
- Быстрые команды (создать, открыть, фильтровать)
- История последних действий

### 2.3. Центр уведомлений и активности

**Местоположение**: TopBar справа, иконка 🔔  
**Референс**: Битрикс24, Slack

#### Типы уведомлений
```
┌─────────────────────────────────────────────┐
│  🔔 Уведомления                        [Все] │
│  ──────────────────────────────────────────── │
│  🔴 Закупка №518801 - просрочен дедлайн!   │
│     2 часа назад                            │
│                                             │
│  💬 Новый комментарий в сделке "Мост"      │
│     Иванов И.И. - 1 час назад               │
│                                             │
│  📄 КП-2024-001 отправлено клиенту          │
│     Система - 3 часа назад                  │
│                                             │
│  🎯 Сделка перемещена в "Переговоры"        │
│     Петров П.П. - 5 часов назад             │
│                                             │
│  [Показать все]                             │
└─────────────────────────────────────────────┘
```

**Виды уведомлений:**
- ⏰ Приближающиеся дедлайны
- 🔴 Просроченные задачи
- 💬 Новые комментарии
- 📄 Изменения в документах
- 🎯 Перемещения сделок по воронке
- 📧 Новые письма от клиентов
- 👤 Упоминания (@username)
- ⚡ Триггеры автоматизации

### 2.4. Детальная карточка сделки - расширенная версия

**Референс**: Salesforce Opportunity Record, Битрикс24 Deal Card

#### Новая структура вкладок
```
┌─────────────────────────────────────────────────────────────┐
│  💼 Закупка (№518801)                           [✖️]         │
│  ───────────────────────────────────────────────────────────│
│  [Обзор] [Контакты] [КП/Товары] [Активность] [Файлы]       │
│  ───────────────────────────────────────────────────────────│
│                                                             │
│  [Содержимое вкладки]                                       │
│                                                             │
│                                                             │
│  ───────────────────────────────────────────────────────────│
│  💬 Комментарии и обсуждение                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Добавить комментарий или @упоминание...             │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### Вкладка "Обзор" (расширенная)
- **Основная информация** (как сейчас)
- **Ключевые метрики** (KPI карточки)
  - Сумма сделки
  - Маржа
  - Вероятность закрытия
  - Дней в текущем этапе
- **Чеклист / Подзадачи**
  - ☑️ Подготовить коммерческое предложение
  - ☐ Отправить КП клиенту
  - ☐ Согласовать цены
- **Связанные сделки/закупки**
- **Теги и метки**

#### Вкладка "Активность" (НОВАЯ!)
```
┌──────────────────────────────────────────────────┐
│  📅 История изменений                             │
│  ───────────────────────────────────────────────── │
│  18.12.2024 14:30                                │
│  👤 Иванов И.И.                                   │
│  📝 Сделка перемещена: "Анализ" → "Переговоры"    │
│                                                   │
│  18.12.2024 12:15                                │
│  👤 Петров П.П.                                   │
│  💬 Добавил комментарий: "Уточнить цены..."       │
│                                                   │
│  17.12.2024 16:45                                │
│  👤 Система                                        │
│  📄 Создано КП-2024-001 (85 000 ₽)              │
│                                                   │
│  17.12.2024 10:00                                │
│  👤 Иванов И.И.                                   │
│  ✨ Сделка создана                                │
└──────────────────────────────────────────────────┘
```

**Отслеживаемые события:**
- Создание/изменение полей
- Перемещения по этапам
- Комментарии
- Прикрепление/удаление файлов
- Создание/выполнение задач
- Email переписка
- Звонки (если есть интеграция)
- Встречи

#### Вкладка "Файлы" (НОВАЯ!)
```
┌──────────────────────────────────────────────────┐
│  📎 Прикрепленные файлы          [➕ Загрузить]   │
│  ───────────────────────────────────────────────── │
│  📄 КП-2024-001.pdf               2.5 MB         │
│     Иванов И.И. - 17.12.2024                     │
│     [Скачать] [Просмотр] [Удалить]               │
│                                                   │
│  📄 Смета.xlsx                    1.2 MB         │
│     Петров П.П. - 16.12.2024                     │
│     [Скачать] [Просмотр] [Удалить]               │
│                                                   │
│  🖼️ План объекта.png              3.8 MB         │
│     Сидоров С.С. - 15.12.2024                    │
│     [Скачать] [Просмотр] [Удалить]               │
│                                                   │
│  📁 Drag & Drop файлы сюда или нажмите "Загрузить"│
└──────────────────────────────────────────────────┘
```

**Функциональность:**
- Загрузка файлов (drag-and-drop)
- Просмотр (изображения, PDF)
- Скачивание
- Удаление (с подтверждением)
- Информация о загрузившем
- Версионирование (опционально)

### 2.5. Фильтры и группировка в канбане

**Местоположение**: Над канбан-доской

```
┌──────────────────────────────────────────────────────────────┐
│  📊 Поставка материалов                                       │
│  ─────────────────────────────────────────────────────────────│
│  🔍 Поиск...   │  👤 Ответственный ▼  │  🏷️ Теги ▼  │  📅 Дата ▼  │
│  [✓ Активные]  [✓ В работе]  [ ] Архивные                    │
│  ─────────────────────────────────────────────────────────────│
│  Группировать по: [Не группировать ▼]                        │
│                   - Не группировать                           │
│                   - По ответственному                         │
│                   - По приоритету                             │
│                   - По тегам                                  │
│  ─────────────────────────────────────────────────────────────│
│  [Канбан-доска с колонками]                                   │
└──────────────────────────────────────────────────────────────┘
```

**Фильтры:**
- По ответственному
- По тегам/меткам
- По дате создания/изменения
- По сумме сделки
- По дедлайну
- По статусу (активные/архивные/выигранные/проигранные)

**Группировка (Swim Lanes):**
```
Группировать по: Ответственному

┌─────────────────────────────────────────────────────┐
│  👤 Иванов И.И. (5 сделок)                          │
│  ──────────────────────────────────────────────────── │
│  [Этап 1]  [Этап 2]  [Этап 3]  [Этап 4]            │
│  [Карточка] [Карточка] [Карточка]                    │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  👤 Петров П.П. (3 сделки)                          │
│  ──────────────────────────────────────────────────── │
│  [Этап 1]  [Этап 2]  [Этап 3]  [Этап 4]            │
│  [Карточка] [Карточка]                               │
└─────────────────────────────────────────────────────┘
```

### 2.6. Календарь событий (НОВЫЙ РАЗДЕЛ!)

**Местоположение**: Новый раздел в главном меню  
**Референс**: Google Calendar, Битрикс24 Calendar

```
┌──────────────────────────────────────────────────────────────┐
│  📅 Календарь                          [День] [Неделя] [Месяц] │
│  ─────────────────────────────────────────────────────────────│
│  < Декабрь 2024 >                                             │
│  ─────────────────────────────────────────────────────────────│
│  ПН   ВТ   СР   ЧТ   ПТ   СБ   ВС                            │
│  16   17   18   19   20   21   22                             │
│        📅   🔴                                                 │
│        КП   Дедлайн!                                          │
│                                                               │
│  23   24   25   26   27   28   29                             │
│                                                               │
│  ─────────────────────────────────────────────────────────────│
│  📋 События на 18 декабря:                                    │
│  10:00 - Встреча с ООО "Строймастер"                         │
│  14:00 - Дедлайн: Отправить КП-2024-001                      │
│  16:00 - Звонок: Уточнить детали закупки №518801             │
└──────────────────────────────────────────────────────────────┘
```

**Типы событий:**
- 📅 Встречи с клиентами
- 📞 Запланированные звонки
- 📧 Отправка писем
- ⏰ Дедлайны сделок
- 🎯 Этапы воронки (дата планируемого перехода)
- ✅ Задачи с датой выполнения

### 2.7. Теги и метки (Tags/Labels)

**Местоположение**: Везде (карточки, фильтры, поиск)  
**Референс**: Trello Labels

#### Использование тегов
```
Тег: 🏷️ Гидроизоляция
- Применяется к сделкам по гидроизоляции
- Цвет: Синий (#2196F3)

Тег: 🏷️ Мост
- Применяется к проектам мостов
- Цвет: Оранжевый (#FF9800)

Тег: 🏷️ Срочно
- Высокий приоритет
- Цвет: Красный (#F44336)

Тег: 🏷️ Крупная сделка
- Сумма > 1 млн ₽
- Цвет: Зеленый (#4CAF50)
```

**Функциональность:**
- Создание/редактирование/удаление тегов
- Назначение цвета
- Присвоение нескольким сделкам
- Фильтрация по тегам
- Поиск по тегам
- Автоматические теги (по сумме, по дедлайну, по типу)

---

## 📊 РАЗДЕЛ 3: Улучшения функционала

### 3.1. Быстрые действия на карточках (Quick Actions)

**Референс**: Trello Card Buttons, Битрикс24 Quick Actions

```
При hover над карточкой появляются кнопки:

┌──────────────────────────────────────┐
│  Закупка (№518801)                   │
│  [⋮] [✏️ Изменить] [📋 Копировать]   │ ← Быстрые действия
│  [🗑️ Удалить] [⭐ В избранное]       │
└──────────────────────────────────────┘
```

**Действия:**
- ✏️ **Редактировать** (открыть карточку)
- 📋 **Копировать** (создать дубликат)
- 🗑️ **Удалить** (с подтверждением)
- ⭐ **В избранное** (закрепить)
- 📧 **Отправить email** (быстрая отправка)
- 👤 **Сменить ответственного**
- 🏷️ **Добавить тег**
- 📅 **Установить дедлайн**

### 3.2. Комментарии и обсуждения

**Местоположение**: Детальная карточка сделки (внизу) + вкладка "Активность"

```
┌──────────────────────────────────────────────────┐
│  💬 Комментарии (5)                               │
│  ───────────────────────────────────────────────── │
│  👤 Иванов И.И. - 18.12.2024 14:30               │
│  Нужно уточнить цены на гидроизоляцию с           │
│  @ПетровП.П., клиент просит скидку 10%            │
│  [Ответить] [Редактировать] [Удалить]             │
│                                                   │
│     👤 Петров П.П. - 18.12.2024 15:00            │
│     Договорились, можем дать 8% скидку            │
│     [Ответить]                                    │
│                                                   │
│  👤 Система - 17.12.2024 16:45                    │
│  📄 Создано КП-2024-001 на сумму 85 000 ₽        │
│                                                   │
│  ───────────────────────────────────────────────── │
│  ✍️ [Добавить комментарий...]                     │
│  [Bold] [Italic] [@Упомянуть] [📎 Файл] [Отправить]│
└──────────────────────────────────────────────────┘
```

**Функциональность:**
- Создание комментариев
- Упоминания пользователей (@username)
- Редактирование/удаление своих комментариев
- Ответы на комментарии (threading)
- Прикрепление файлов к комментариям
- Форматирование текста (жирный, курсив, списки)
- Уведомления при упоминании

### 3.3. Чеклисты и подзадачи

**Местоположение**: Детальная карточка сделки, вкладка "Обзор"  
**Референс**: Trello Checklists

```
┌──────────────────────────────────────────────────┐
│  ✅ Чеклист: Подготовка КП          [⋮]          │
│  ───────────────────────────────────────────────── │
│  Прогресс: ██████░░░░ 60% (3/5)                  │
│                                                   │
│  ☑️ Собрать информацию о клиенте                 │
│  ☑️ Рассчитать стоимость материалов              │
│  ☑️ Согласовать цены с поставщиками              │
│  ☐ Подготовить коммерческое предложение          │
│  ☐ Отправить КП клиенту                          │
│                                                   │
│  [➕ Добавить задачу]                             │
└──────────────────────────────────────────────────┘
```

**Функциональность:**
- Создание чеклистов
- Добавление/удаление задач
- Отметка выполненных задач
- Прогресс-бар выполнения
- Назначение ответственного на задачу
- Установка дедлайна на задачу
- Переупорядочивание задач (drag-and-drop)

### 3.4. Связи между сущностями

**Цель**: Показать взаимосвязи между закупками, сделками, КП, клиентами

```
┌──────────────────────────────────────────────────┐
│  🔗 Связанные сущности                            │
│  ───────────────────────────────────────────────── │
│  📋 Закупка №518801 (источник)                    │
│     └─ 💼 Сделка "Поставка материалов"           │
│         └─ 📄 КП-2024-001 (85 000 ₽)            │
│         └─ 👥 ООО "Строймастер" (заказчик)       │
│             └─ 👤 Иванов Иван (ЛПР)              │
│                                                   │
│  [➕ Добавить связь]                              │
└──────────────────────────────────────────────────┘
```

**Типы связей:**
- Закупка → Сделка
- Сделка → КП
- Сделка → Клиент
- Сделка → Контакт
- КП → Товары
- Сделка → Задачи
- Сделка → Файлы

### 3.5. Массовые операции

**Местоположение**: Канбан-доска, при выборе нескольких карточек

```
[✓] Выбрано 3 сделки:
[👤 Назначить ответственного] [🏷️ Добавить тег] [🗑️ Удалить] [📧 Отправить email]
```

**Операции:**
- Назначение ответственного
- Добавление тегов
- Изменение этапа
- Удаление
- Экспорт
- Архивирование

### 3.6. Шаблоны сделок (Templates)

**Цель**: Ускорить создание типовых сделок

```
┌──────────────────────────────────────────────────┐
│  📋 Создать сделку из шаблона                     │
│  ───────────────────────────────────────────────── │
│  📝 Поставка гидроизоляции                        │
│     Включает: чеклист (5 задач), теги, поля       │
│                                                   │
│  📝 Участие в тендере (44-ФЗ)                     │
│     Включает: чеклист (7 задач), дедлайны         │
│                                                   │
│  📝 Субподрядные работы                           │
│     Включает: чеклист (6 задач), КП               │
│                                                   │
│  [➕ Создать новый шаблон]                        │
└──────────────────────────────────────────────────┘
```

### 3.7. Автоматизация и триггеры (Automation)

**Референс**: Битрикс24 Automation, Salesforce Workflow

```
┌──────────────────────────────────────────────────┐
│  ⚡ Автоматизация                                 │
│  ───────────────────────────────────────────────── │
│  Правило #1: "Уведомить о приближающемся дедлайне"│
│  КОГДА: Дедлайн через 1 день                     │
│  ТО: Отправить уведомление ответственному        │
│  [✓ Активно]                                      │
│                                                   │
│  Правило #2: "Автоматическое назначение тега"    │
│  КОГДА: Сумма сделки > 1 000 000 ₽              │
│  ТО: Добавить тег "Крупная сделка"               │
│  [✓ Активно]                                      │
│                                                   │
│  Правило #3: "Уведомить менеджера о застое"      │
│  КОГДА: Сделка в этапе > 7 дней                  │
│  ТО: Отправить email менеджеру                   │
│  [✓ Активно]                                      │
│                                                   │
│  [➕ Создать правило]                             │
└──────────────────────────────────────────────────┘
```

**Триггеры:**
- При изменении этапа
- При приближении дедлайна
- При изменении суммы
- При создании сделки
- При добавлении комментария
- При упоминании пользователя
- При простое на этапе N дней

**Действия:**
- Отправить уведомление
- Отправить email
- Добавить тег
- Изменить ответственного
- Создать задачу
- Изменить поле
- Запустить вебхук

---

## 🎯 РАЗДЕЛ 4: Приоритизация внедрения

### Фаза 1: Критические улучшения (MVP) - 2-3 недели

**Цель**: Базовый функционал, который даст максимальный прирост UX

✅ **1.1. Улучшенные карточки сделок**
- Добавить цветовые индикаторы приоритета
- Добавить аватар ответственного
- Добавить индикатор дедлайна
- Добавить теги
- Добавить счетчики (файлы, комментарии)

✅ **1.2. Быстрые действия на карточках**
- Hover меню с кнопками
- Редактировать, копировать, удалить

✅ **1.3. Комментарии в карточке сделки**
- Добавление комментариев
- Просмотр истории комментариев
- Упоминания пользователей

✅ **1.4. Прикрепление файлов**
- Загрузка файлов к сделке
- Просмотр списка файлов
- Скачивание файлов

✅ **1.5. История изменений (вкладка "Активность")**
- Отслеживание всех изменений
- Временная шкала событий

### Фаза 2: Расширенный функционал - 3-4 недели

**Цель**: Аналитика и продвинутые инструменты управления

✅ **2.1. Дашборд с аналитикой**
- KPI карточки
- Графики воронки
- Топ сделки
- Требуют внимания

✅ **2.2. Глобальный поиск (Command Palette)**
- Поиск по всем сущностям
- Быстрые команды

✅ **2.3. Центр уведомлений**
- Уведомления о событиях
- История уведомлений

✅ **2.4. Фильтры и группировка в канбане**
- Фильтры по полям
- Группировка (swim lanes)
- Сохранение фильтров

✅ **2.5. Теги и метки**
- Создание тегов
- Присвоение тегам цветов
- Фильтрация по тегам

### Фаза 3: Автоматизация и интеграции - 4-5 недель

**Цель**: Автоматизация рутинных процессов

✅ **3.1. Чеклисты и подзадачи**
- Создание чеклистов
- Назначение задач
- Прогресс выполнения

✅ **3.2. Календарь событий**
- Визуализация событий
- Интеграция с дедлайнами
- Планирование встреч

✅ **3.3. Автоматизация (триггеры)**
- Правила автоматизации
- Триггеры на события
- Действия по триггерам

✅ **3.4. Шаблоны сделок**
- Создание шаблонов
- Применение шаблонов
- Библиотека шаблонов

✅ **3.5. Связи между сущностями**
- Визуализация связей
- Граф зависимостей

---

## 💡 РАЗДЕЛ 5: Референсы и примеры

### Salesforce Lightning Experience
**Что взять:**
- Дизайн дашборда с KPI
- Command Palette (Ctrl+K)
- Детальные карточки с вкладками
- Система уведомлений
- Автоматизация (Workflow Rules)

### Битрикс24 CRM
**Что взять:**
- Воронки продаж с канбаном
- Центр активности
- Комментарии с упоминаниями
- Лента событий
- Интеграция с email

### Trello
**Что взять:**
- Drag-and-drop карточек
- Теги/метки с цветами
- Чеклисты
- Быстрые действия на карточках
- Простота и интуитивность

### Monday.com
**Что взять:**
- Гибкие представления (канбан/таблица/календарь)
- Автоматизация
- Цветовые индикаторы статусов
- Прогресс-бары

### Notion
**Что взять:**
- Гибкая структура данных
- Связи между сущностями
- Богатые текстовые редакторы
- Шаблоны

---

## 📐 РАЗДЕЛ 6: Дизайн-система и UI Kit

### 6.1. Цветовая палитра (расширенная)

**Текущая палитра Bitrix24:**
```python
COLORS = {
    'primary': '#2066B0',       # Основной синий
    'primary_dark': '#1A5490',  # Темно-синий (hover)
    'secondary': '#F5F5F5',     # Светло-серый фон
    'white': '#FFFFFF',
    'text_dark': '#535C69',     # Темный текст
    'text_light': '#828282',    # Светлый текст
    'border': '#D5D5D5',        # Цвет границ
    'success': '#9ECF00',       # Зеленый успех
    'warning': '#FFA726',       # Оранжевое предупреждение
    'error': '#E53935',         # Красная ошибка
}
```

**Предложение: Добавить дополнительные цвета**
```python
COLORS = {
    # ... существующие ...
    
    # Приоритеты
    'priority_high': '#E53935',    # Красный (высокий)
    'priority_medium': '#FFA726',  # Оранжевый (средний)
    'priority_low': '#9ECF00',     # Зеленый (низкий)
    
    # Статусы сделок
    'deal_new': '#2196F3',         # Синий (новая)
    'deal_active': '#FF9800',      # Оранжевый (в работе)
    'deal_won': '#4CAF50',         # Зеленый (выиграна)
    'deal_lost': '#9E9E9E',        # Серый (проиграна)
    
    # Теги (базовые цвета)
    'tag_blue': '#2196F3',
    'tag_green': '#4CAF50',
    'tag_orange': '#FF9800',
    'tag_red': '#F44336',
    'tag_purple': '#9C27B0',
    'tag_cyan': '#00BCD4',
    
    # Фоны
    'background_hover': '#E3F2FD',   # Синий hover
    'background_selected': '#BBDEFB', # Синий selected
    'background_disabled': '#EEEEEE', # Серый disabled
    
    # Разделители
    'divider_light': '#E0E0E0',
    'divider_dark': '#BDBDBD',
}
```

### 6.2. Новые компоненты

#### Компонент: Badge (Бейдж)
**Назначение**: Отображение счетчиков, статусов, меток

```python
BADGE_STYLES = {
    'primary': f"""
        QLabel {{
            background: {COLORS['primary']};
            color: white;
            border-radius: {scale_size(12)}px;
            padding: {scale_size(4)}px {scale_size(8)}px;
            font-size: {FONT_SIZES['small']};
            font-weight: bold;
        }}
    """,
    'success': f"""
        QLabel {{
            background: {COLORS['success']};
            color: white;
            border-radius: {scale_size(12)}px;
            padding: {scale_size(4)}px {scale_size(8)}px;
            font-size: {FONT_SIZES['small']};
            font-weight: bold;
        }}
    """,
    'warning': f"""
        QLabel {{
            background: {COLORS['warning']};
            color: white;
            border-radius: {scale_size(12)}px;
            padding: {scale_size(4)}px {scale_size(8)}px;
            font-size: {FONT_SIZES['small']};
            font-weight: bold;
        }}
    """,
}
```

**Использование:**
```python
# Бейдж с числом уведомлений
badge = QLabel("3")
apply_badge_style(badge, 'primary')

# Бейдж статуса
status_badge = QLabel("Активна")
apply_badge_style(status_badge, 'success')
```

#### Компонент: Tag/Chip (Тег)
**Назначение**: Отображение тегов с возможностью удаления

```python
class Tag(QFrame):
    """Компонент тега с кнопкой удаления"""
    
    removed = pyqtSignal(str)  # Сигнал удаления тега
    
    def __init__(self, text: str, color: str = None, removable: bool = True, parent=None):
        super().__init__(parent)
        self.text = text
        self.color = color or COLORS['primary']
        self.removable = removable
        self.init_ui()
    
    def init_ui(self):
        layout = QHBoxLayout(self)
        layout.setSpacing(4)
        layout.setContentsMargins(8, 4, 8, 4)
        
        # Текст тега
        label = QLabel(self.text)
        apply_label_style(label, 'small')
        label.setStyleSheet(f"color: white; font-weight: bold;")
        layout.addWidget(label)
        
        # Кнопка удаления
        if self.removable:
            remove_btn = QPushButton("✖")
            remove_btn.setFixedSize(16, 16)
            remove_btn.clicked.connect(lambda: self.removed.emit(self.text))
            layout.addWidget(remove_btn)
        
        # Стиль тега
        self.setStyleSheet(f"""
            QFrame {{
                background: {self.color};
                border-radius: {scale_size(4)}px;
            }}
        """)
```

#### Компонент: Avatar (Аватар)
**Назначение**: Отображение аватара пользователя

```python
class Avatar(QLabel):
    """Компонент аватара пользователя"""
    
    def __init__(self, initials: str, size: int = 32, color: str = None, parent=None):
        super().__init__(parent)
        self.initials = initials
        self.size = size
        self.color = color or COLORS['primary']
        self.init_ui()
    
    def init_ui(self):
        self.setText(self.initials)
        self.setAlignment(Qt.AlignCenter)
        self.setFixedSize(self.size, self.size)
        
        self.setStyleSheet(f"""
            QLabel {{
                background: {self.color};
                color: white;
                border-radius: {self.size // 2}px;
                font-weight: bold;
                font-size: {int(self.size * 0.4)}px;
            }}
        """)
```

#### Компонент: ProgressCircle (Круговой прогресс)
**Назначение**: Отображение прогресса чеклистов

```python
class ProgressCircle(QWidget):
    """Круговой индикатор прогресса"""
    
    def __init__(self, progress: int = 0, size: int = 40, parent=None):
        super().__init__(parent)
        self.progress = progress  # 0-100
        self.size = size
        self.setFixedSize(size, size)
    
    def paintEvent(self, event):
        painter = QPainter(self)
        painter.setRenderHint(QPainter.Antialiasing)
        
        # Фон
        painter.setPen(QPen(QColor(COLORS['border']), 4))
        painter.drawEllipse(2, 2, self.size - 4, self.size - 4)
        
        # Прогресс
        painter.setPen(QPen(QColor(COLORS['primary']), 4))
        angle = int(self.progress * 360 / 100)
        painter.drawArc(2, 2, self.size - 4, self.size - 4, 90 * 16, -angle * 16)
        
        # Текст
        painter.setPen(QPen(QColor(COLORS['text_dark'])))
        painter.setFont(QFont(FONT_FAMILY, 10, QFont.Bold))
        painter.drawText(self.rect(), Qt.AlignCenter, f"{self.progress}%")
```

---

## 🛠️ РАЗДЕЛ 7: Технические рекомендации

### 7.1. Архитектура новых компонентов

```
modules/
├── crm/
│   ├── dashboard/                  # НОВЫЙ: Дашборд
│   │   ├── widget.py              # Главный виджет дашборда
│   │   ├── kpi_card.py            # KPI карточка
│   │   ├── funnel_chart.py        # График воронки
│   │   └── activity_chart.py      # График активности
│   │
│   ├── sales_funnel/
│   │   ├── deal_card.py           # УЛУЧШИТЬ: Расширенная карточка
│   │   ├── deal_detail_dialog.py  # УЛУЧШИТЬ: Новые вкладки
│   │   ├── filters_widget.py      # НОВЫЙ: Фильтры
│   │   ├── kanban_board.py        # УЛУЧШИТЬ: Группировка
│   │   └── ...
│   │
│   ├── calendar/                   # НОВЫЙ: Календарь
│   │   ├── widget.py              # Главный виджет календаря
│   │   ├── day_view.py            # Представление дня
│   │   ├── week_view.py           # Представление недели
│   │   └── month_view.py          # Представление месяца
│   │
│   ├── notifications/              # НОВЫЙ: Уведомления
│   │   ├── center_widget.py       # Центр уведомлений
│   │   ├── notification_item.py   # Элемент уведомления
│   │   └── service.py             # Сервис уведомлений
│   │
│   └── ...
│
├── common/                         # НОВЫЙ: Общие компоненты
│   ├── components/
│   │   ├── badge.py               # Бейдж
│   │   ├── tag.py                 # Тег
│   │   ├── avatar.py              # Аватар
│   │   ├── progress_circle.py     # Круговой прогресс
│   │   ├── command_palette.py     # Command Palette
│   │   └── quick_actions.py       # Быстрые действия
│   │
│   ├── services/
│   │   ├── search_service.py      # Глобальный поиск
│   │   ├── notification_service.py # Уведомления
│   │   └── activity_tracker.py    # Отслеживание активности
│   │
│   └── utils/
│       ├── formatters.py          # Форматтеры (дата, валюта и т.д.)
│       └── validators.py          # Валидаторы
│
└── styles/
    ├── components/                 # НОВЫЙ: Стили компонентов
    │   ├── badge_styles.py
    │   ├── tag_styles.py
    │   └── avatar_styles.py
    └── ...
```

### 7.2. База данных: Новые таблицы

```sql
-- Комментарии к сделкам
CREATE TABLE deal_comments (
    id BIGSERIAL PRIMARY KEY,
    deal_id BIGINT NOT NULL REFERENCES sales_deals(id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL,
    comment_text TEXT NOT NULL,
    parent_comment_id BIGINT REFERENCES deal_comments(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    is_deleted BOOLEAN DEFAULT FALSE
);

-- Файлы, прикрепленные к сделкам
CREATE TABLE deal_files (
    id BIGSERIAL PRIMARY KEY,
    deal_id BIGINT NOT NULL REFERENCES sales_deals(id) ON DELETE CASCADE,
    filename TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT NOT NULL,
    mime_type TEXT,
    uploaded_by BIGINT NOT NULL,
    uploaded_at TIMESTAMPTZ DEFAULT NOW()
);

-- История изменений сделки
CREATE TABLE deal_activity (
    id BIGSERIAL PRIMARY KEY,
    deal_id BIGINT NOT NULL REFERENCES sales_deals(id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL,
    activity_type TEXT NOT NULL, -- 'created', 'updated', 'moved', 'commented', 'file_added'
    field_name TEXT,             -- Какое поле изменено
    old_value TEXT,              -- Старое значение
    new_value TEXT,              -- Новое значение
    description TEXT,            -- Описание события
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Теги
CREATE TABLE tags (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    color TEXT NOT NULL,        -- Hex цвет
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Связь тегов и сделок
CREATE TABLE deal_tags (
    deal_id BIGINT NOT NULL REFERENCES sales_deals(id) ON DELETE CASCADE,
    tag_id BIGINT NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (deal_id, tag_id)
);

-- Чеклисты
CREATE TABLE deal_checklists (
    id BIGSERIAL PRIMARY KEY,
    deal_id BIGINT NOT NULL REFERENCES sales_deals(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Задачи чеклиста
CREATE TABLE checklist_items (
    id BIGSERIAL PRIMARY KEY,
    checklist_id BIGINT NOT NULL REFERENCES deal_checklists(id) ON DELETE CASCADE,
    text TEXT NOT NULL,
    is_completed BOOLEAN DEFAULT FALSE,
    assigned_to BIGINT,          -- user_id
    due_date DATE,
    position INT NOT NULL,       -- Порядок задач
    created_at TIMESTAMPTZ DEFAULT NOW(),
    completed_at TIMESTAMPTZ
);

-- Уведомления
CREATE TABLE notifications (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    type TEXT NOT NULL,          -- 'deadline', 'comment', 'mention', 'moved'
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    link TEXT,                   -- Ссылка на объект (deal_id, comment_id и т.д.)
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Правила автоматизации
CREATE TABLE automation_rules (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    trigger_type TEXT NOT NULL,  -- 'field_changed', 'stage_changed', 'deadline_approaching'
    trigger_conditions JSONB NOT NULL,
    actions JSONB NOT NULL,      -- Массив действий
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Шаблоны сделок
CREATE TABLE deal_templates (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    pipeline_type TEXT NOT NULL,
    default_fields JSONB,        -- Значения полей по умолчанию
    checklists JSONB,            -- Чеклисты для создания
    tags JSONB,                  -- Теги для присвоения
    created_by BIGINT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Индексы для производительности
CREATE INDEX idx_deal_comments_deal_id ON deal_comments(deal_id);
CREATE INDEX idx_deal_files_deal_id ON deal_files(deal_id);
CREATE INDEX idx_deal_activity_deal_id ON deal_activity(deal_id);
CREATE INDEX idx_deal_activity_created_at ON deal_activity(created_at DESC);
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_is_read ON notifications(is_read);
```

### 7.3. Миграции

**Создать новый файл миграции:**
```bash
scripts/sql_queries/add_crm_enhancements_v2.sql
```

**Запустить миграцию:**
```python
# scripts/apply_crm_enhancements_v2.py
import psycopg2
from pathlib import Path
from dotenv import load_dotenv
import os

load_dotenv()

def apply_migration():
    conn = psycopg2.connect(
        host=os.getenv("TENDER_MONITOR_DB_HOST"),
        database=os.getenv("TENDER_MONITOR_DB_DATABASE"),
        user=os.getenv("TENDER_MONITOR_DB_USER"),
        password=os.getenv("TENDER_MONITOR_DB_PASSWORD"),
        port=os.getenv("TENDER_MONITOR_DB_PORT", "5432")
    )
    
    sql_path = Path(__file__).parent / "sql_queries" / "add_crm_enhancements_v2.sql"
    sql_script = sql_path.read_text(encoding='utf-8')
    
    with conn.cursor() as cur:
        cur.execute(sql_script)
    
    conn.commit()
    conn.close()
    print("✅ Миграция успешно применена!")

if __name__ == "__main__":
    apply_migration()
```

---

## ✅ Чеклист внедрения

### Этап 1: Подготовка (1 неделя)
- [ ] Изучить референсы (Salesforce, Битрикс24, Trello)
- [ ] Создать дизайн-макеты (Figma/Sketch)
- [ ] Утвердить дизайн
- [ ] Подготовить миграции БД

### Этап 2: Базовые компоненты (2 недели)
- [ ] Создать Badge, Tag, Avatar компоненты
- [ ] Улучшить DealCard (приоритет, дедлайн, теги)
- [ ] Добавить быстрые действия на карточках
- [ ] Добавить вкладку "Активность" в DealDetailDialog
- [ ] Реализовать комментарии

### Этап 3: Файлы и история (1 неделя)
- [ ] Добавить загрузку файлов
- [ ] Реализовать отслеживание изменений (ActivityTracker)
- [ ] Создать историю событий

### Этап 4: Дашборд (2 недели)
- [ ] Создать DashboardWidget
- [ ] Реализовать KPI карточки
- [ ] Добавить графики (воронка, активность)
- [ ] Интегрировать с данными из БД

### Этап 5: Поиск и уведомления (1-2 недели)
- [ ] Реализовать глобальный поиск (CommandPalette)
- [ ] Создать NotificationCenter
- [ ] Добавить уведомления о событиях

### Этап 6: Фильтры и группировка (1 неделя)
- [ ] Добавить FiltersWidget в канбан
- [ ] Реализовать группировку (Swim Lanes)
- [ ] Добавить сохранение фильтров

### Этап 7: Чеклисты и теги (1 неделя)
- [ ] Реализовать Checklist компонент
- [ ] Добавить управление тегами
- [ ] Интегрировать теги в карточки и фильтры

### Этап 8: Календарь (2 недели)
- [ ] Создать CalendarWidget
- [ ] Реализовать представления (день/неделя/месяц)
- [ ] Интегрировать с дедлайнами сделок

### Этап 9: Автоматизация (2 недели)
- [ ] Создать AutomationRules модуль
- [ ] Реализовать триггеры
- [ ] Добавить UI для управления правилами

### Этап 10: Шаблоны и массовые операции (1 неделя)
- [ ] Реализовать DealTemplates
- [ ] Добавить массовые операции
- [ ] Тестирование и отладка

---

## 📚 Дополнительные материалы

### Полезные ресурсы
- [Salesforce Lightning Design System](https://www.lightningdesignsystem.com/)
- [Bitrix24 CRM Demo](https://www.bitrix24.com/crm/)
- [Trello Design](https://trello.com/guide/trello-101)
- [Material Design Components](https://material.io/components)

### Библиотеки для PyQt5
- `PyQtGraph` - графики и визуализация
- `PyQt5-Frameless-Window` - кастомные окна
- `QFluentWidgets` - современные UI компоненты

---

## 🎉 Заключение

Этот документ содержит комплексный план по улучшению UI/UX вашего приложения B2B AutoDesk. Реализация всех предложений займет ~3-4 месяца при работе в одиночку или ~1.5-2 месяца в команде из 2-3 разработчиков.

**Ключевые преимущества после внедрения:**
✨ Современный и интуитивный интерфейс  
✨ Повышение продуктивности пользователей  
✨ Лучшая визуализация данных  
✨ Автоматизация рутинных задач  
✨ Конкурентоспособность на уровне Salesforce и Битрикс24  

**Рекомендация по приоритизации:**
Начните с **Фазы 1** (критические улучшения), так как она даст максимальный прирост UX при минимальных затратах времени. После этого переходите к дашборду и аналитике (**Фаза 2**), так как это существенно повысит ценность системы для руководства.

Удачи в разработке! 🚀

---

## 📌 Статус выполнения (живой чеклист)

**Текущая фаза:** Фаза 1 — критические улучшения (MVP)  
**Текущий шаг:** Этап 2 — Базовые компоненты (визуальное усиление карточек сделок)

### Фазы
- [ ] Фаза 1 — Критические улучшения (MVP)
- [ ] Фаза 2 — Расширенный функционал (дашборд, поиск, уведомления)
- [ ] Фаза 3 — Автоматизация и интеграции

### Детализация по шагам

#### Этап 1: Подготовка
- [x] Зафиксировать общую концепцию UI/UX и референсы (Salesforce, Битрикс24, Trello)  
- [ ] Уточнить приоритеты по разделам (что делаем в первую очередь по факту реализации)

#### Этап 2: Базовые компоненты (Фаза 1 — старт)
- [ ] Визуально усилить `DealCard` (структура, типографика, фон, аккуратная сетка)
- [ ] Добавить цветовые акценты статуса/типа воронки на карточке
- [ ] Подготовить место под быстрые действия на карточке (UI без логики)

#### Этап 3: Детальная карточка сделки
- [ ] Сделать более «CRM‑ный» summary‑блок в `DealDetailDialog`
- [ ] Разложить существующие данные по вкладкам более удобно

#### Этап 4: Каркас для будущих фич
- [ ] Добавить вкладку‑заглушку «Активность» в детальной карточке
- [ ] Добавить вкладку‑заглушку «Файлы» в детальной карточке

> Все новые изменения по прогрессу работ по UI/UX фиксируем только в этом разделе, чтобы всегда видеть, **на каком шаге сейчас находимся и что уже сделано**.

